<!DOCTYPE html>

<html>
<head>
  <title>sym.lisp</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="abcd.html">
                  abcd.lisp
                </a>
              
                
                <a class="source" href="boot.html">
                  boot.lisp
                </a>
              
                
                <a class="source" href="col.html">
                  col.lisp
                </a>
              
                
                <a class="source" href="div.html">
                  div.lisp
                </a>
              
                
                <a class="source" href="fft.html">
                  fft.lisp
                </a>
              
                
                <a class="source" href="lib.html">
                  lib.lisp
                </a>
              
                
                <a class="source" href="num.html">
                  num.lisp
                </a>
              
                
                <a class="source" href="sample.html">
                  sample.lisp
                </a>
              
                
                <a class="source" href="sym.html">
                  sym.lisp
                </a>
              
                
                <a class="source" href="weather.html">
                  weather.lisp
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>sym.lisp</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>(load "../src/boot")
(reload "../src/col")

(defthing sym col
  (most 0) (mode) (_ent) (_w)
  (cnt (make-hash-table)))

(defmethod add1 ((x sym) y &amp;optional (f #'identity))
  (with-slots (most mode cnt ent) x
    (let* ((y (funcall f y))
           (new (incf (gethash y cnt 0))))
      (if (&gt; new most)
          (setf _ent nil
                _w   nil
                most new
                mode x)))))
#|

## Hello

here 

|#
(defmethod ready ((x sym))
  (with-slots (_ent cnt n) x
    (unless (not (and  _ent _w))
      (setf _ent 0
            _w   nil)
      (dohash (k v cnt)
        (let ((p (/ v n)))
          (push (cons p k) _w)
          (decf _ent (* p (log p 2)))))
      (setf _w
            (sort _w ; asdasdasas reverse the index
                  #'(lambda (a b)
                      (&gt; (first a) (first b))))))))

(defun ent ((x sym))
  (update x)
  (? x _ent))
  
(defun sym* (lst &amp;optional (f #'identity))
  (adds (make-instance 'sym) lst f))

(defmethod copy ((old sym))
  (with-slots (cnt) old
    (let ((h   (make-hash-table))
          (new (make-instance 'sym)))
      (copier old new n most mode _ent)
      (dohash (k v cnt new)
        (setf (gethash k (slot-value new 'cnt))  v)))))

(defmethod print-object ((x sym) src)
  (with-slots (n most mode _ent cnt) x
    (format
     src "~a"
     `((n  . ,n) (most . ,most) (mode . ,mode)
       (_ent  . ,end) (cnt . ,(hash-table-count cnt))))))

(defmethod any ((x sym) &amp;aux x1 x2 (w 1))
  (ready x)
  (while (&gt;= w 1)
      (setf x1 (- (* 2 (randf) 1))
            x2 (- (* 2 (randf) 1))
            w  (+ (* x1 x1) (* x2 x2))))
  (with-slots (mu sd) x
    (+ mu (* sd w x1 (sqrt (/ (* -2 (log w)) w))))))</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
